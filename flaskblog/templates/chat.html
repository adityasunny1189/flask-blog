{% extends "layout.html" %}
{% block content %}
<div class="container" style="background-color: #272822;">
  <h1 class="blog-chat-head">LetConnect.co Global Chat</h1>
  <div id="mario-chat">
    <h3 class="blog-chat-box">No message yet..</h3>
    <div class="message_holder" id="chat-window"></div>

    <form action="" method="POST" style="margin-bottom: 30px;">
      <input type="text" class="message blog-chat-imput" placeholder="Messages"/>
      <button class="chat-but" placeholder="Send">Send</button>
    </form>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
  <script type="text/javascript">
    var socket = io.connect('http://' + document.domain + ':' + location.port);

    socket.on( 'connect', function() {
      socket.emit( 'my event', {
        data: 'User Connected'
      } )
      var form = $( 'form' ).on( 'submit', function( e ) {
        e.preventDefault()
        let user_name = '{{ current_user.username }}'
        let user_input = $( 'input.message' ).val()
        socket.emit( 'my event', {
          user_name : user_name,
          message : user_input
        } )
        $( 'input.message' ).val( '' ).focus()
      } )
    } )
    socket.on( 'my response', function( msg ) {
      console.log( msg )
      if( typeof msg.user_name !== 'undefined' ) {
        $( 'h3' ).remove()
        $( 'div.message_holder' ).append( '<div class = "outer"><span id="output" class = "strong">'+msg.user_name + ' : ' +'</span> <span id = "feedback"> '+msg.message+'</span></div>' )
      }
    })
  </script>
</div>
{% endblock %}